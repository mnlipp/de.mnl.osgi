<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>de.mnl.osgi.jul2osgi (de.mnl.osgi.jul2osgi 2.0.0-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: de.mnl.osgi.jul2osgi">
<meta name="generator" content="javadoc/PackageWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#package">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Package:&nbsp;</li>
<li><a href="#package-description">Description</a>&nbsp;|&nbsp;</li>
<li>Related Packages&nbsp;|&nbsp;</li>
<li><a href="#class-summary">Classes and Interfaces</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 title="Package de.mnl.osgi.jul2osgi" class="title">Package de.mnl.osgi.jul2osgi</h1>
</div>
<hr>
<div class="package-signature">package <span class="element-name">de.mnl.osgi.jul2osgi</span></div>
<section class="package-description" id="package-description">
<div class="block">A bundle that forwards java.util.logging (JUL) records to the
 OSGi logging service.
 <P>
 <a href="https://github.com/mnlipp/de.mnl.osgi/issues" target="_blank">
   <img alt="GitHub issues" src="https://img.shields.io/github/issues/mnlipp/de.mnl.osgi.svg"></a>
 <a href="https://search.maven.org/#search%7Cga%7C1%7Ca%3A%22de.mnl.osgi.jul2osgi%22" target="_blank">
   <img alt="Maven Central" src="https://img.shields.io/maven-central/v/de.mnl.osgi/de.mnl.osgi.jul2osgi.svg"></a>
 
 <h2>Installation</h2>
 
 This bundle (the main bundle) works together with the 
 bundle <code>de.mnl.osgi.jul2osgi.lib</code> (the library bundle), 
 which provides a replacement for the default 
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/LogManager.html" title="class or interface in java.util.logging" class="external-link"><code>LogManager</code></a>.
 Replacing the <code>LogManager</code> has the advantage that
 all interactions with JUL can be intercepted.
 <P>
 The library bundle must be put on the JVM bootstrap classpath or the
 framework classpath by the launcher because the Java runtime accesses the 
 <code>LogManager</code> early during
 application boot. The replacement <code>LogManager</code> is made known to JUL 
 by invoking the JVM with the corresponding system property: "<code>java 
 -Djava.util.logging.manager=de.mnl.osgi.jul2osgi.lib.LogManager ...</code>".
 Usually, such system properties can be configured in the OSGi launcher.
 Until the main bundle is started,
 the <code>LogManager</code> records all JUL <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/LogRecord.html" title="class or interface in java.util.logging" class="external-link"><code>LogRecord</code></a>
 in a buffer. The size of the buffer can be configured with the system 
 property <code>de.mnl.osgi.jul2osgi.bufferSize</code>, which defaults to 100.
 <P>
 The main bundle is deployed as any other OSGi bundle
 
 <h3>bnd launcher before 4.3.0</h3>
 
 The library bundle can be put on the framework
 classpath with the <code>-runpath</code> instruction 
 (<a href="https://bnd.bndtools.org/instructions/runpath.html">bnd</a>), 
 the property is set with the <code>-runvm: ...</code> instruction. 
 <P>
 Example configuration:
 <pre> -runpath: de.mnl.osgi.jul2osgi.lib;version='latest'
 -runvm: -Djava.util.logging.manager=de.mnl.osgi.jul2osgi.lib.LogManager</pre>
 
 <h3>bnd launcher starting with 4.3.0</h3>
 
 With 4.3.0 the handling of the <code>-runpath</code> instruction 
 <a href="https://groups.google.com/forum/#!topic/bndtools-users/-GkCoepqbTk">has 
 changed</a>. The library must therefore be added to the bootstrap classpath.
 Because this does not add the exported packages to the system capabilities,
 this must be done explicitly.
 <P>
 Example configuration:
 <pre> -runvm: -Xbootclasspath/a:${repo;de.mnl.osgi.jul2osgi.lib;latest}, \
   -Djava.util.logging.manager=de.mnl.osgi.jul2osgi.lib.LogManager
 -runsystempackages: \
   de.mnl.osgi.jul2osgi.lib; version=1.4.2</pre>
 
 <h2>Forwarding functionality</h2>
 
 When the main bundle is started, it first requests an OSGI log service 
 from the framework. When this service becomes available, the forwarder 
 in the main bundle registers a callback with the <code>LogManager</code>. 
 The <code>LogManager</code> uses the callback to send all recorded and 
 future JUL <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/LogRecord.html" title="class or interface in java.util.logging" class="external-link"><code>LogRecord</code></a>s
 to the main bundle. The forwarder converts the information from the
 <code>LogRecords</code> to calls of one of the methods of an OSGi
 <a href="https://docs.osgi.org/javadoc/osgi.cmpn/7.0.0/org/osgi/service/log/Logger.html" title="class or interface in org.osgi.service.log" class="external-link"><code>Logger</code></a>.
 <P>
 JUL <code>LogRecord</code> properties are mapped in the following way:
 <ul>
   <li>logger name: used as logger name when requesting the
       OSGi Logger.</li>
   <li>message: passed as message parameter (see below).</li>
   <li>level: used to choose the method to call. <code>FINE</code> is mapped
       to a call to <code>debug</code>, anything below is mapped to
       a call to <code>trace</code>.
   <li>thrown: passed to the OSGi logger, becomes the exception property
       of the OSGi <code>LogRecord</code>.</li>
 </ul>

 The forwarder also attempts to determine the bundle within which
 the JUL <code>Logger</code> was created and use it as origin of the event 
 when forwarding to OSGI logging. Only if determining the bundle
 fails will the log event appear to have been created by bundle
 <code>de.mnl.osgi.jul2osgi</code>.
 <P>
 Special handling is applied by the forwarder if <i>recorded</i> log 
 entries are forwarded to the OSGi <a href="https://docs.osgi.org/javadoc/osgi.cmpn/7.0.0/org/osgi/service/log/Logger.html" title="class or interface in org.osgi.service.log" class="external-link"><code>Logger</code></a>. 
 The implementation of the logger automatically derives a "thread info" 
 property for the newly created OSGI <code>LogRecord</code> from the calling 
 thread. There is no way to override this automatically created value, 
 which is obviously wrong when a thread forwards log events that have
 been recorded while executing other threads. Therefore the current
 thread's name is added to the recorded information. When flushing the
 recorded log events later, the name of the flushing thread is 
 temporarily set to the recorded name with "<code>[recorded]</code>"
 appended.
 <P>
 When using JUL, the message passed to the JUL <code>Logger</code> isn't
 necessarily what you see in your log. It is first used to lookup
 a mapping in the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html" title="class or interface in java.util" class="external-link"><code>ResourceBundle</code></a> associated with
 the <code>LogRecord</code>. Then, it is passed to a formatter that may
 insert representations of parameters associated with the 
 <code>LogRecord</code>. This processing is supposed to take place 
 during the final processing, i.e. in a JUL 
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/Handler.html" title="class or interface in java.util.logging" class="external-link"><code>Handler</code></a>.
 <P>
 The OSGi log service does not provide such sophisticated post-processing
 of log entries. The message text and the parameters from the JUL
 <code>LogRecord</code> are therefore processed before forwarding the message
 to the OSGi <code>Logger</code>. In this respect, the forwarder behaves like a
 JUL <code>Handler</code>.
 <P>
 Before passing the post-processed message to the OSGi <code>Logger</code>
 the forwarder applies another formatting operation. It invokes
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/text/MessageFormat.html#format(java.lang.String,java.lang.Object...)" title="class or interface in java.text" class="external-link"><code>MessageFormat.format(String, Object...)</code></a> with
 a format string, the post-processed message and the remaining
 information from the JUL <code>LogRecord</code>. This allows the remaining
 information to be added to the message sent to the OSGi log service.
 <P>
 The <code>format</code> method is invoked as: 
 <P>
 <code>format(logPattern,
 message, millis, sequenceNumber, sourceClassName, sourceMethodName,
 threadID)</code>
 <P>
 In order to e.g. add the source class name and method
 to the log message the pattern "<code>{3}.{4}: {0}</code>" could be used.
 
 <h2>Filtering</h2>
 
 Calls to the JUL <code>Logger</code> are filtered before further processing
 according to the result from (JUL)
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/Logger.html#isLoggable(java.util.logging.Level)" title="class or interface in java.util.logging" class="external-link"><code>Logger.isLoggable(java.util.logging.Level)</code></a> and
 by any configured JUL filter. Calls that pass this barrier are 
 forwarded to OSGi logging.
 <P>
 OSGi logging filters the forwarded events according to the level
 configured for the originating bundle and OSGi logger before accepting
 the event.
 <P>
 If you want log events to be delivered for levels lower than the 
 default levels, you must therefore lower the levels in both configurations. 
 Be aware that the default levels for JUL and OSGi logging differ. JUL
 uses the default level <code>INFO</code> while OSGi logging uses the default 
 level <code>WARNING</code>.
 <P>
 In order to avoid unnecessary processing of eventually discarded log
 events, filtering should preferably be configured using JUL. Anything
 that passes this first barrier can then be accepted by OSGi logging
 without further restrictions. Following this approach, the default
 level for bundles using JUL should thus best be set to 
 <a href="https://docs.osgi.org/javadoc/osgi.cmpn/7.0.0/org/osgi/service/log/LogLevel.html#TRACE" title="class or interface in org.osgi.service.log" class="external-link"><code>LogLevel.TRACE</code></a> (see bundle property below).
 
 <h2>Bundle properties</h2>
 
 The following bundle properties are used to configure the described 
 behavior.
 
 <table>
   <caption>Bundle parameters</caption>
   <thead>
     <tr>
       <th>Property</th><th>Description</th><th>Default</th>
     </tr>
   </thead>
   <tbody>
     <tr>
       <td><code>de.mnl.osgi.jul2osgi.logPattern</code></td>
       <td>The final formating pattern</td>
       <td><code>{0}</code></td>
     </tr>
     <tr>
       <td><code>de.mnl.osgi.jul2osgi.adaptOSGiLevel</code></td>
       <td>If set to <code>true</code>, the OSGi log level for the 
           originating bundle of a JUL log event will automatically
           ne set to <a href="https://docs.osgi.org/javadoc/osgi.cmpn/7.0.0/org/osgi/service/log/LogLevel.html#TRACE" title="class or interface in org.osgi.service.log" class="external-link"><code>LogLevel.TRACE</code></a>.
           This results in the expected behavior that any log 
           message that has been enabled in JUL is visible in the
           OSGi log.</td>
       <td><code>true</code></td>
     </tr>
   </tbody>
 </table></div>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div id="class-summary">
<div class="caption"><span>Classes</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="Forwarder.html" title="class in de.mnl.osgi.jul2osgi">Forwarder</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">&nbsp;</div>
</div>
</div>
</li>
</ul>
</section>
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><div><!-- Optional footer data --><p id=githubfooter style="padding: 5px 6px; visibility: hidden">Hosted on GitHub Pages &mdash; <a href="https://github.com/site/terms" target="_top">Terms</a>&mdash; <a href="https://github.com/site/privacy" target="_top">Privacy</a></p><script type="text/javascript">if (location.hostname.indexOf("github") !== -1) {document.getElementById("githubfooter").style.visibility="visible";<!-- Matomo anonymous, no cookies (https://matomo.org/blog/2018/04/how-to-not-process-any-personal-data-with-matomo-and-what-it-means-for-you/) -->var _paq = _paq || [];/* tracker methods like "setCustomDimension" should be called before "trackPageView" */_paq.push(["setDocumentTitle", document.domain + "/" + document.title]);_paq.push(["setCookieDomain", "*.mnlipp.github.io"]);_paq.push(["setDomains", ["*.mnlipp.github.io"]]);_paq.push(['disableCookies']);_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function() {var u="//piwik.mnl.de/";_paq.push(['setTrackerUrl', u+'piwik.php']);_paq.push(['setSiteId', '14']);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);})();<!-- End Matomo Code -->}</script><noscript><div>JavaScript is disabled on your browser, terms and privacy links may not be shown correctly.</div><!-- Matomo anonymous, no cookies (https://matomo.org/blog/2018/04/how-to-not-process-any-personal-data-with-matomo-and-what-it-means-for-you/) --><img src="https://piwik.mnl.de/piwik.php?idsite=14&amp;rec=1&amp;action_name=JGrapes" style="border:0" alt="" /><!-- End Matomo Code --></noscript></div></small></p>
</footer>
</div>
</div>
</body>
</html>
